"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4171],{1138:(j,F,c)=>{c.d(F,{K:()=>s});var m=c(4438),u=c(1626);let s=(()=>{var g;class p{constructor(l){this.http=l,this.baseUrl="http://localhost:8100"}login(l,h){return this.http.post(`${this.baseUrl}/login`,{username:l,password:h})}getHomeData(){return this.http.get(`${this.baseUrl}/api/home`)}getStatusData(){return this.http.get(`${this.baseUrl}/api/status`)}getUsers(){return this.http.get(`${this.baseUrl}/api/users`)}getHistoricalData(){return this.http.get(`${this.baseUrl}/api/historical`)}getLastHourData(){return this.http.get(`${this.baseUrl}/api/last-hour-data`)}addUser(l){return this.http.post(`${this.baseUrl}/api/users`,l)}updateUser(l,h){return this.http.put(`${this.baseUrl}/api/users/${l}`,h,{headers:{"Content-Type":"application/json"}})}deleteUser(l){return this.http.delete(`${this.baseUrl}/api/users/${l}`,{headers:{"Content-Type":"application/json"}})}}return(g=p).\u0275fac=function(l){return new(l||g)(m.KVO(u.Qq))},g.\u0275prov=m.jDH({token:g,factory:g.\u0275fac,providedIn:"root"}),p})()},6552:(j,F,c)=>{c.r(F),c.d(F,{SettingsPageModule:()=>R});var m=c(177),u=c(4341),s=c(4742),g=c(8986),p=c(467),e=c(4438),l=c(1138);const h=r=>({color:r});function U(r,a){if(1&r&&(e.j41(0,"ion-row",6)(1,"ion-col"),e.EFF(2),e.k0s(),e.j41(3,"ion-col"),e.EFF(4),e.k0s(),e.j41(5,"ion-col"),e.EFF(6),e.k0s(),e.j41(7,"ion-col"),e.EFF(8),e.k0s(),e.j41(9,"ion-col"),e.EFF(10),e.k0s(),e.j41(11,"ion-col"),e.EFF(12),e.k0s(),e.j41(13,"ion-col"),e.EFF(14),e.k0s(),e.j41(15,"ion-col"),e.EFF(16),e.k0s(),e.j41(17,"ion-col",7),e.EFF(18),e.k0s(),e.j41(19,"ion-col",7),e.EFF(20),e.k0s()()),2&r){const n=a.$implicit;e.R7$(2),e.JRh(n.fechaHora),e.R7$(2),e.JRh(n.irradiancia),e.R7$(2),e.JRh(n.potencia),e.R7$(2),e.JRh(n.tempPanel1),e.R7$(2),e.JRh(n.tempPanel2),e.R7$(2),e.JRh(n.tempGabinete),e.R7$(2),e.JRh(n.rssi),e.R7$(2),e.JRh(n.bateria),e.R7$(),e.Y8G("ngStyle",e.eq3(12,h,"OK"===n.estadoSistema?"green":"red")),e.R7$(),e.SpI(" ",n.estadoSistema," "),e.R7$(),e.Y8G("ngStyle",e.eq3(14,h,"On"===n.estadoInverter?"blue":"orange")),e.R7$(),e.SpI(" ",n.estadoInverter," ")}}function b(r,a){if(1&r){const n=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Agregar Nuevo Usuario"),e.k0s()(),e.j41(4,"ion-card-content")(5,"form",8),e.bIt("submit",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.addUser())}),e.j41(6,"ion-item")(7,"ion-label",9),e.EFF(8,"Nombre de usuario"),e.k0s(),e.j41(9,"ion-input",10),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.newUser.username,t)||(i.newUser.username=t),e.Njj(t)}),e.k0s()(),e.j41(10,"ion-item")(11,"ion-label",9),e.EFF(12,"Rol"),e.k0s(),e.j41(13,"ion-select",11),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.newUser.role,t)||(i.newUser.role=t),e.Njj(t)}),e.j41(14,"ion-select-option",12),e.EFF(15,"Administrador"),e.k0s(),e.j41(16,"ion-select-option",13),e.EFF(17,"Usuario"),e.k0s()()(),e.j41(18,"ion-item")(19,"ion-label",9),e.EFF(20,"Contrase\xf1a"),e.k0s(),e.j41(21,"ion-input",14),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.newUser.password,t)||(i.newUser.password=t),e.Njj(t)}),e.k0s()(),e.j41(22,"ion-button",15),e.nrm(23,"ion-icon",16),e.EFF(24," Agregar Usuario "),e.k0s()()()()}if(2&r){const n=e.XpG();e.R7$(9),e.R50("ngModel",n.newUser.username),e.R7$(4),e.R50("ngModel",n.newUser.role),e.R7$(8),e.R50("ngModel",n.newUser.password),e.R7$(),e.Y8G("disabled",!n.newUser.username||!n.newUser.role||!n.newUser.password)}}function f(r,a){if(1&r){const n=e.RV6();e.j41(0,"ion-item"),e.nrm(1,"ion-icon",18),e.j41(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p"),e.EFF(6),e.k0s()(),e.j41(7,"ion-button",19),e.bIt("click",function(){const t=e.eBV(n),i=t.$implicit,E=t.index,_=e.XpG(2);return e.Njj(_.editUser(i,E))}),e.nrm(8,"ion-icon",20),e.EFF(9," Editar "),e.k0s(),e.j41(10,"ion-button",21),e.bIt("click",function(){const t=e.eBV(n).index,i=e.XpG(2);return e.Njj(i.confirmDeleteUser(t))}),e.nrm(11,"ion-icon",22),e.EFF(12," Eliminar "),e.k0s()()}if(2&r){const n=a.$implicit;e.R7$(4),e.JRh(n.username),e.R7$(2),e.SpI("Rol: ",n.role,"")}}function w(r,a){if(1&r&&(e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Usuarios Existentes"),e.k0s()(),e.j41(4,"ion-card-content")(5,"ion-list"),e.DNE(6,f,13,2,"ion-item",17),e.k0s()()()),2&r){const n=e.XpG();e.R7$(6),e.Y8G("ngForOf",n.users)}}function S(r,a){if(1&r){const n=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3,"Editar Usuario"),e.k0s()(),e.j41(4,"ion-card-content")(5,"form",8),e.bIt("submit",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.saveEditedUser())}),e.j41(6,"ion-item")(7,"ion-label",9),e.EFF(8,"Nombre de usuario"),e.k0s(),e.j41(9,"ion-input",23),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.newUser.username,t)||(i.newUser.username=t),e.Njj(t)}),e.k0s()(),e.j41(10,"ion-item")(11,"ion-label",9),e.EFF(12,"Rol"),e.k0s(),e.j41(13,"ion-select",24),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.newUser.role,t)||(i.newUser.role=t),e.Njj(t)}),e.j41(14,"ion-select-option",12),e.EFF(15,"Administrador"),e.k0s(),e.j41(16,"ion-select-option",13),e.EFF(17,"Usuario"),e.k0s()()(),e.j41(18,"ion-item")(19,"ion-label",9),e.EFF(20,"Contrase\xf1a"),e.k0s(),e.j41(21,"ion-input",25),e.mxI("ngModelChange",function(t){e.eBV(n);const i=e.XpG();return e.DH7(i.newUser.password,t)||(i.newUser.password=t),e.Njj(t)}),e.k0s()(),e.j41(22,"ion-button",26),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.confirmSaveChanges())}),e.nrm(23,"ion-icon",27),e.EFF(24," Guardar Cambios "),e.k0s(),e.j41(25,"ion-button",28),e.bIt("click",function(){e.eBV(n);const t=e.XpG();return e.Njj(t.cancelEdit())}),e.nrm(26,"ion-icon",29),e.EFF(27," Cancelar "),e.k0s()()()()}if(2&r){const n=e.XpG();e.R7$(9),e.R50("ngModel",n.newUser.username),e.R7$(4),e.R50("ngModel",n.newUser.role),e.R7$(8),e.R50("ngModel",n.newUser.password),e.R7$(),e.Y8G("disabled",!n.newUser.username||!n.newUser.role)}}const k=[{path:"",component:(()=>{var r;class a{constructor(o,t){this.alertController=o,this.remoteService=t,this.users=[],this.newUser={username:"",role:"usuario",password:""},this.historicalData=[],this.isEditing=!1,this.editingIndex=-1}ngOnInit(){this.loadUsers(),this.loadHistoricalData()}loadUsers(){this.remoteService.getUsers().subscribe(o=>{this.users=o.map(t=>({id:t.id,username:t.nombre,role:t.rol})),console.log("Usuarios cargados:",this.users)},o=>{console.error("Error al cargar usuarios:",o)})}loadHistoricalData(){this.remoteService.getHistoricalData().subscribe(o=>{this.historicalData=o},o=>{console.error("Error al cargar datos hist\xf3ricos:",o)})}confirmDeleteUser(o){var t=this;return(0,p.A)(function*(){yield(yield t.alertController.create({header:"Confirmar Eliminaci\xf3n",message:"\xbfEst\xe1s seguro de que deseas eliminar este usuario?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Eliminaci\xf3n cancelada")}},{text:"Eliminar",role:"destructive",handler:()=>{t.removeUser(o)}}]})).present()})()}confirmSaveChanges(){var o=this;return(0,p.A)(function*(){yield(yield o.alertController.create({header:"Confirmar Cambios",message:"\xbfDeseas guardar los cambios realizados al usuario?",buttons:[{text:"Cancelar",role:"cancel",handler:()=>{console.log("Guardado cancelado")}},{text:"Guardar",handler:()=>{-1!==o.editingIndex&&o.saveEditedUser()}}]})).present()})()}addUser(){if(this.newUser.username.trim()){if("admin"===this.newUser.role&&(!this.newUser.password||""===this.newUser.password.trim()))return void console.error("La contrase\xf1a no puede estar vac\xeda para usuarios administradores.");this.remoteService.addUser(this.newUser).subscribe(o=>{this.users.push({...this.newUser,id:o.id}),this.newUser={username:"",role:"usuario",password:""}},o=>{console.error("Error al agregar usuario:",o)})}else console.error("El nombre de usuario no puede estar vac\xedo.")}removeUser(o){this.remoteService.deleteUser(this.users[o].id).subscribe(i=>{console.log("Usuario eliminado exitosamente"),this.users.splice(o,1)},i=>{console.error("Error al eliminar usuario:",i)})}editUser(o,t){this.isEditing=!0,this.editingIndex=t,this.newUser={...o}}saveEditedUser(){if(-1!==this.editingIndex&&void 0!==this.newUser.id){const o={username:this.newUser.username,role:this.newUser.role};this.newUser.password&&""!==this.newUser.password.trim()&&(o.password=this.newUser.password),this.remoteService.updateUser(this.newUser.id,o).subscribe(t=>{this.users[this.editingIndex]={...this.newUser,id:this.newUser.id},this.cancelEdit()},t=>{console.error("Error al actualizar usuario:",t)})}else console.error("Error: El usuario no tiene un ID v\xe1lido.")}cancelEdit(){this.isEditing=!1,this.editingIndex=-1,this.newUser={username:"",role:""}}exportToCSV(){const t=this.historicalData.map(d=>[d.fechaHora,d.irradiancia,d.potencia,d.tempPanel1,d.tempPanel2,d.tempGabinete,d.rssi,d.bateria,d.estadoSistema,d.estadoInverter]),i="data:text/csv;charset=utf-8,"+[["Fecha y Hora","Irradiancia (W/m\xb2)","Potencia (W)","Temp. Panel 1 (\xb0C)","Temp. Panel 2 (\xb0C)","Temp. Gabinete (\xb0C)","RSSI (dBm)","Bater\xeda (%)","Estado Sistema","Estado Inverter"].join(","),...t.map(d=>d.join(","))].join("\n"),E=encodeURI(i),_=document.createElement("a");_.setAttribute("href",E),_.setAttribute("download","datos_historicos.csv"),document.body.appendChild(_),_.click(),document.body.removeChild(_)}}return(r=a).\u0275fac=function(o){return new(o||r)(e.rXU(s.hG),e.rXU(l.K))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-settings"]],decls:54,vars:4,consts:[["color","primary",3,"click"],["slot","start","name","download-outline"],[1,"historical-data-grid"],[1,"header-row"],["class","data-row",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"data-row"],[3,"ngStyle"],[3,"submit"],["position","floating"],["name","username","required","",3,"ngModelChange","ngModel"],["name","role","required","",3,"ngModelChange","ngModel"],["value","admin"],["value","usuario"],["type","password","name","password","required","",3,"ngModelChange","ngModel"],["expand","block","type","submit","color","primary",3,"disabled"],["slot","start","name","add-circle"],[4,"ngFor","ngForOf"],["slot","start","name","person-circle","color","primary"],["color","secondary",3,"click"],["slot","start","name","create-outline"],["color","danger",3,"click"],["slot","start","name","trash-outline"],["name","editUsername","required","",3,"ngModelChange","ngModel"],["name","editRole","required","",3,"ngModelChange","ngModel"],["type","password","name","editPassword","required","",3,"ngModelChange","ngModel"],["expand","block","color","primary",3,"click","disabled"],["slot","start","name","save-outline"],["expand","block","color","medium",3,"click"],["slot","start","name","arrow-back-outline"]],template:function(o,t){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Configuraci\xf3n"),e.k0s()()(),e.j41(4,"ion-content")(5,"ion-card")(6,"ion-card-header")(7,"ion-card-title"),e.EFF(8,"Datos Hist\xf3ricos"),e.k0s(),e.j41(9,"ion-button",0),e.bIt("click",function(){return t.exportToCSV()}),e.nrm(10,"ion-icon",1),e.EFF(11," Exportar CSV "),e.k0s()(),e.j41(12,"ion-card-content")(13,"ion-grid",2)(14,"ion-row",3)(15,"ion-col")(16,"strong"),e.EFF(17,"Fecha y Hora"),e.k0s()(),e.j41(18,"ion-col")(19,"strong"),e.EFF(20,"Irradiancia (W/m\xb2)"),e.k0s()(),e.j41(21,"ion-col")(22,"strong"),e.EFF(23,"Potencia (W)"),e.k0s()(),e.j41(24,"ion-col")(25,"strong"),e.EFF(26,"Temp. Panel 1 (\xb0C)"),e.k0s()(),e.j41(27,"ion-col")(28,"strong"),e.EFF(29,"Temp. Panel 2 (\xb0C)"),e.k0s()(),e.j41(30,"ion-col")(31,"strong"),e.EFF(32,"Temp. Gabinete (\xb0C)"),e.k0s()(),e.j41(33,"ion-col")(34,"strong"),e.EFF(35,"RSSI (dBm)"),e.k0s()(),e.j41(36,"ion-col")(37,"strong"),e.EFF(38,"Bater\xeda (%)"),e.k0s()(),e.j41(39,"ion-col")(40,"strong"),e.EFF(41,"Estado Sistema"),e.k0s()(),e.j41(42,"ion-col")(43,"strong"),e.EFF(44,"Estado Inverter"),e.k0s()()(),e.DNE(45,U,21,16,"ion-row",4),e.k0s()()(),e.j41(46,"ion-card")(47,"ion-card-header")(48,"ion-card-title"),e.EFF(49,"Gesti\xf3n de Usuarios"),e.k0s()(),e.j41(50,"ion-card-content"),e.DNE(51,b,25,4,"ion-card",5)(52,w,7,1,"ion-card",5)(53,S,28,4,"ion-card",5),e.k0s()()()),2&o&&(e.R7$(45),e.Y8G("ngForOf",t.historicalData),e.R7$(6),e.Y8G("ngIf",!t.isEditing),e.R7$(),e.Y8G("ngIf",!t.isEditing),e.R7$(),e.Y8G("ngIf",t.isEditing))},dependencies:[m.Sq,m.bT,m.B3,u.qT,u.BC,u.cb,u.YS,u.vS,u.cV,s.Jm,s.b_,s.I9,s.ME,s.tN,s.hU,s.W9,s.lO,s.eU,s.iq,s.$w,s.uz,s.he,s.nf,s.ln,s.Nm,s.Ip,s.BC,s.ai,s.Je,s.Gw],styles:[".historical-data-grid[_ngcontent-%COMP%]   ion-row.header-row[_ngcontent-%COMP%]{background:#f4f4f4;font-weight:700;text-align:center}.historical-data-grid[_ngcontent-%COMP%]   ion-row.header-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;padding:10px}.historical-data-grid[_ngcontent-%COMP%]   ion-row.data-row[_ngcontent-%COMP%]{text-align:center}.historical-data-grid[_ngcontent-%COMP%]   ion-row.data-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{border-bottom:1px solid #eaeaea;padding:10px;font-size:.9rem}.historical-data-grid[_ngcontent-%COMP%]   ion-row.data-row[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]:nth-child(2n){background:#f9f9f9}"]}),a})()}];let C=(()=>{var r;class a{}return(r=a).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[g.iI.forChild(k),g.iI]}),a})(),R=(()=>{var r;class a{}return(r=a).\u0275fac=function(o){return new(o||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[m.MD,u.YN,s.bv,C]}),a})()}}]);